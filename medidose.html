<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediDose Label Generator</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
</head>
<body>
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <h2>Enter Password</h2>
            <input type="password" id="passwordInput" placeholder="Password">
            <button onclick="checkPassword()" class="generate-btn">Submit</button>
            <p id="passwordError" style="color: red; display: none;">Incorrect password</p>
        </div>
    </div>

    <nav class="sidebar">
        <div class="sidebar-header">
            <h2>Menu</h2>
        </div>
        <ul class="sidebar-nav">
            <li><a href="index.html">Home</a></li>
            <li><a href="medidose.html" class="active">MediDose Labels</a></li>
            <li><a href="rxlabel.html">Rx Labels</a></li>
            <li><a href="settings.html">Settings</a></li>
        </ul>
    </nav>

    <div id="mainContent" class="main-content" style="display: none;">
        <div class="container">
            <h1>Medication Label Generator</h1>
            <form id="labelForm">
                <div class="form-group">
                    <label for="brandName">Brand Name</label>
                    <input type="text" id="brandName" placeholder="brand name" required>
                </div>

                <div class="form-group">
                    <label for="genericName">Generic Name</label>
                    <input type="text" id="genericName" placeholder="generic name" required>
                </div>

                <div class="form-group">
                    <label for="ndc">NDC</label>
                    <input type="text" id="ndc" placeholder="XXXX-XXXX-XX" required>
                </div>

                <div class="form-group">
                    <label for="strength">Strength</label>
                    <input type="text" id="strength" placeholder="strength (include units)" required>
                </div>

                <div class="form-group">
                    <label for="form">Form</label>
                    <input type="text" id="form" placeholder="(tablets, capsules, etc.)" required>
                </div>

                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="packager" required>
                </div>

                <div class="form-group">
                    <label for="controlled">Controlled</label>
                    <select id="controlled">
                        <option value="">None</option>
                        <option value="2">Schedule II</option>
                        <option value="3">Schedule III</option>
                        <option value="4">Schedule IV</option>
                        <option value="5">Schedule V</option>
                    </select>
                </div>

                <button type="submit" class="generate-btn">create medidose label</button>
            </form>
        </div>
    </div>

<!-- Password Modal for Printing -->
<div id="print-password-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; justify-content: center; align-items: center;">
    <div style="background: white; padding: 40px; border-radius: 10px; max-width: 400px; width: 90%;">
        <h2 style="margin-top: 0;">Enter Password to Print</h2>
        <form id="print-password-form">
            <div class="form-group">
                <input type="password" id="print-password-input" placeholder="Password" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 1em; box-sizing: border-box; margin-bottom: 10px;">
            </div>
            <button type="submit" style="width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 5px; font-size: 1em; cursor: pointer; margin-bottom: 10px;">Print</button>
            <button type="button" id="cancel-print" style="width: 100%; padding: 12px; background: #6c757d; color: white; border: none; border-radius: 5px; font-size: 1em; cursor: pointer;">Cancel</button>
            <div id="print-password-error" style="color: #dc3545; margin-top: 10px; display: none;">Incorrect password!</div>
        </form>
    </div>
</div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="firebase-data.js"></script>

    <script>
    const printPasswordModal = document.getElementById('print-password-modal');
    const printPasswordForm = document.getElementById('print-password-form');
    const printPasswordInput = document.getElementById('print-password-input');
    const printPasswordError = document.getElementById('print-password-error');
    const cancelPrintBtn = document.getElementById('cancel-print');

    const originalPrintLabel = window.printLabel;
    window.printLabel = function() {
        printPasswordModal.style.display = 'flex';
    };

    printPasswordForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const password = printPasswordInput.value;
        
        try {
            const isValid = await settingsManager.verifyPassword(password);
            if (isValid) {
                printPasswordModal.style.display = 'none';
                printPasswordError.style.display = 'none';
                printPasswordInput.value = '';
                // Call the original print function
                window.print();
            } else {
                printPasswordError.style.display = 'block';
                printPasswordInput.value = '';
            }
        } catch (error) {
            console.error('Error checking password:', error);
            printPasswordError.textContent = 'Error checking password. Please try again.';
            printPasswordError.style.display = 'block';
        }
    });

    cancelPrintBtn.addEventListener('click', () => {
        printPasswordModal.style.display = 'none';
        printPasswordInput.value = '';
        printPasswordError.style.display = 'none';
    });
    </script>
</body>
</html>